<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- name space는 UserRepo의 fully qualified name으로 설정한다. -->

<mapper namespace="com.kiki.review.model.dao.ReviewDao">
	
	<resultMap type="ReviewDto" id="reviewList">
		<id column="seq" property="seq" />
		<id column="title" property="title" />
		<id column="content" property="content" />
		<id column="user_name" property="userName" />
		<id column="created_date" property="createdDate" />
		<id column="modified_date" property="modifiedDate" />
		<id column="deleted_date" property="deletedDate" />
		<id column="image_code" property="imageCode" />
	</resultMap>


	<!-- id는 repo클래스의 메소드 이름과 일치시킨다. -->
	<insert id="writeReview" parameterType="ReviewDto">
		INSERT INTO review (title, content, user_name, modified_date, deleted_date)
		VALUES (#{title}, #{content}, #{userName}, #{modifiedDate}, #{deletedDate})
	</insert>
	
	<select id="getList" resultMap="reviewList">
		SELECT r.seq, r.title, r.content, r.user_name, r.created_date, r.modified_date, r.deleted_date, i.image_code
		FROM review AS r
		LEFT JOIN review_image As i
		ON r.seq = i.review_seq
		GROUP BY r.seq
		ORDER BY r.seq
	</select>
	
	<select id="searchReview" parameterType="String">
		SELECT *
		FROM review
		WHERE title LIKE '%#{keyword}%'
	</select>	
</mapper>